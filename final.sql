WITH test_cases AS (
  SELECT row_num, zip_cd, service_cd, service_type_cd, geographic_area_cd, place_of_service_cd, contract_type, specialty_cd, allowed_amt
  FROM UNNEST([
  STRUCT(10688770, 23430, 92015, 'CPT4', 'VA03', 11, 'S', 'OP', 17.03),
  STRUCT(10673854, 11580, 98940, 'CPT4', 'GN01', 11, 'S', 'DC', 16.53),
  STRUCT(10661223, 10003, 97811, 'CPT4', 'GN01', 11, 'S', 'AP', 23.38),
  STRUCT(10636980, 11758, 90837, 'CPT4', 'GN01', 11, 'S', 'SW', 120.67),
  STRUCT(10600538, 37849, 92015, 'CPT4', 'TN06', 11, 'S', '30401', 19.12),
  STRUCT(10591275, 11790, 97811, 'CPT4', 'GN01', 11, 'S', 'AP', 23.38),
  STRUCT(10583561, 20715, 92015, 'CPT4', 'MD02', 11, 'S', '30401', 30.0),
  STRUCT(10548432, 98133, 99213, 'CPT4', 'WA01', 11, 'S', '10401', 103.82),
  STRUCT(10519660, 23112, 99213, 'CPT4', 'VA02', 11, 'S', '10401', 73.07),
  STRUCT(10514813, 98391, 97810, 'CPT4', 'WA01', 11, 'S', 'AP', 42.75),
  STRUCT(10513696, 64116, 98943, 'CPT4', 'MO02', 11, 'S', 'DC', 19.68),
  STRUCT(10471550, 11101, 90837, 'CPT4', 'GN01', 11, 'S', 'CP', 160.89),
  STRUCT(10455740, 12545, 98940, 'CPT4', 'GN01', 11, 'S', 'DC', 16.53),
  STRUCT(10421505, 60435, 90837, 'CPT4', 'IL02', 11, 'S', 'LPC', 116.05),
  STRUCT(10408396, 11790, 97811, 'CPT4', 'GN01', 11, 'S', 'AP', 23.38),
  STRUCT(10374819, 10007, 97110, 'CPT4', 'GN01', 11, 'S', 'DC', 19.41),
  STRUCT(10362173, 78258, 97112, 'CPT4', 'TX02', 11, 'S', 'PT', 22.04),
  STRUCT(10349070, 11731, 97112, 'CPT4', 'GN01', 11, 'S', 'PT', 20.29),
  STRUCT(10294241, 10025, 97810, 'CPT4', 'GN01', 11, 'S', 'AP', 31.49),
  STRUCT(10199658, 89120, 99386, 'CPT4', 'NV01', 11, 'S', '10301', 118.93),
  STRUCT(10155894, 28105, 98940, 'CPT4', 'NC01', 11, 'S', 'DC', 18.98),
  STRUCT(10126312, 97062, 55250, 'CPT4', 'OR01', 11, 'S', '31001', 520.54),
  STRUCT(10060973, 11203, 99386, 'CPT4', 'GN01', 11, 'S', '20101', 114.17),
  STRUCT(10047415, 10011, 97810, 'CPT4', 'GN01', 11, 'S', 'AP', 31.49),
  STRUCT(10024659, 98233, 98941, 'CPT4', 'WA01', 11, 'S', 'DC', 38.61),
  STRUCT(9996779, 27596, 98941, 'CPT4', 'NC02', 11, 'S', 'DC', 27.29),
  STRUCT(9929201, 24060, 58300, 'CPT4', 'VA04', 11, 'S', '20101', 89.25),
  STRUCT(9898690, 10032, 97811, 'CPT4', 'GN01', 11, 'S', 'AP', 23.38),
  STRUCT(9851891, 20814, 97810, 'CPT4', 'MD02', 11, 'S', 'AP', 36.72),
  STRUCT(9831491, 78006, 17000, 'CPT4', 'TX02', 11, 'S', '10601', 60.55),
  STRUCT(9810076, 10021, 97811, 'CPT4', 'GN01', 11, 'S', 'AP', 23.38),
  STRUCT(9706062, 19460, 98943, 'CPT4', 'PA01', 11, 'S', 'DC', 17.34),
  STRUCT(9662349, 84660, 97112, 'CPT4', 'UT01', 11, 'S', 'PT', 32.94),
  STRUCT(9655248, 11572, 98940, 'CPT4', 'GN01', 11, 'S', 'DC', 16.53),
  STRUCT(9627498, 84095, 97810, 'CPT4', 'UT01', 11, 'S', 'AP', 41.42),
  STRUCT(9617101, 60062, 90837, 'CPT4', 'IL02', 11, 'S', 'BHG', 154.74),
  STRUCT(9595274, 60605, 99386, 'CPT4', 'IL02', 11, 'S', '10601', 136.42),
  STRUCT(9589282, 99206, 90837, 'CPT4', 'WA03', 11, 'S', 'CP', 142.69),
  STRUCT(9539564, 11731, 97112, 'CPT4', 'GN01', 11, 'S', 'PT', 20.29),
  STRUCT(9533219, 62959, 98940, 'CPT4', 'IL05', 11, 'S', 'DC', 21.29),
  STRUCT(9481521, 30316, 58300, 'CPT4', 'GA01', 11, 'S', '10301', 84.79),
  STRUCT(9421675, 61821, 98941, 'CPT4', 'IL05', 11, 'S', 'DC', 28.29),
  STRUCT(9387986, 10075, 45380, 'CPT4', 'GN01', 24, 'S', '10301', 240.32),
  STRUCT(9342733, 60618, 90837, 'CPT4', 'IL02', 11, 'S', 'LPC', 116.05),
  STRUCT(9309566, 64068, 92015, 'CPT4', 'MO02', 11, 'S', 'OP', 14.82),
  STRUCT(9287996, 20036, 97810, 'CPT4', 'DC01', 11, 'S', 'AP', 36.72),
  STRUCT(9250905, 27573, 97110, 'CPT4', 'NC02', 11, 'S', 'DC', 24.64),
  STRUCT(9250622, 14850, 92015, 'CPT4', 'NY03', 11, 'S', 'OP', 21.04),
  STRUCT(9240304, 98166, 99213, 'CPT4', 'WA01', 11, 'S', '10401', 103.82),
  STRUCT(9165913, 22193, 97112, 'CPT4', 'VA01', 11, 'S', 'PT', 26.44),
  STRUCT(9131794, 10021, 97811, 'CPT4', 'GN01', 11, 'S', 'AP', 23.38),
  STRUCT(9113881, 28607, 97110, 'CPT4', 'NC05', 11, 'S', 'DC', 24.64),
  STRUCT(9106650, 67230, 90837, 'CPT4', 'KS02', 11, 'S', 'MT', 105.97),
  STRUCT(9069972, 10704, 98940, 'CPT4', 'GN01', 11, 'S', 'DC', 16.53),
  STRUCT(8935846, 29492, 17000, 'CPT4', 'SC01', 11, 'S', '10601', 72.32),
  STRUCT(8928794, 10577, 92014, 'CPT4', 'GN01', 11, 'S', '10414', 94.41),
  STRUCT(8855757, 23059, 97112, 'CPT4', 'VA02', 11, 'S', 'PT', 22.99),
  STRUCT(8847559, 22204, 97810, 'CPT4', 'VA01', 11, 'S', 'AP', 36.72),
  STRUCT(8840005, 83814, 55250, 'CPT4', 'WA03', 11, 'S', '31001', 495.92),
  STRUCT(8823834, 22202, 98940, 'CPT4', 'VA01', 11, 'S', 'DC', 19.39),
  STRUCT(8821542, 60175, 97112, 'CPT4', 'IL02', 11, 'S', 'PT', 27.5),
  STRUCT(8805456, 18042, 97110, 'CPT4', 'PA01', 11, 'S', 'DC', 19.36),
  STRUCT(8797795, 27932, 98941, 'CPT4', 'NC06', 11, 'S', 'DC', 27.29),
  STRUCT(8794955, 98115, 92014, 'CPT4', 'WA01', 11, 'S', 'OP', 173.71),
  STRUCT(8782462, 78258, 97112, 'CPT4', 'TX02', 11, 'S', 'PT', 22.04),
  STRUCT(8758166, 34209, 98941, 'CPT4', 'FL03', 11, 'S', 'DC', 21.59),
  STRUCT(8755291, 20176, 99213, 'CPT4', 'VA01', 11, 'S', '10401', 73.38),
  STRUCT(8708530, 10032, 97811, 'CPT4', 'GN01', 11, 'S', 'AP', 23.38),
  STRUCT(8681471, 12078, 92014, 'CPT4', 'NY02', 11, 'S', '30401', 156.83),
  STRUCT(8647993, 14072, 98941, 'CPT4', 'NY04', 11, 'S', 'DC', 28.74),
  STRUCT(8632207, 64154, 17000, 'CPT4', 'MO02', 11, 'S', '10601', 57.26),
  STRUCT(8558474, 98034, 99385, 'CPT4', 'WA01', 11, 'S', '10301', 172.23),
  STRUCT(8557558, 77079, 90837, 'CPT4', 'TX03', 11, 'S', 'LPC', 114.01),
  STRUCT(8543472, 22401, 97810, 'CPT4', 'VA01', 11, 'S', 'AP', 36.72),
  STRUCT(8532531, 32605, 92014, 'CPT4', 'FL01', 11, 'S', '30401', 87.12),
  STRUCT(8506196, 12189, 99386, 'CPT4', '10301', 145.98),
  STRUCT(8414835, 89521, 98941, 'CPT4', 'NV02', 11, 'S', 'DC', 30.29),
  STRUCT(8406733, 20176, 17000, 'CPT4', 'VA01', 11, 'S', '10601', 69.92),
  STRUCT(8395218, 21228, 97110, 'CPT4', 'MD01', 11, 'S', 'PT', 21.76),
  STRUCT(8350106, 98226, 45380, 'CPT4', 'WA01', 24, 'S', '10307', 272.47),
  STRUCT(8324174, 18017, 97110, 'CPT4', 'PA01', 11, 'S', 'DC', 19.36),
  STRUCT(8265153, 89123, 98941, 'CPT4', 'NV01', 11, 'S', 'DC', 30.29),
  STRUCT(8218077, 60048, 92014, 'CPT4', 'IL02', 11, 'S', '30401', 109.02),
  STRUCT(8194218, 46055, 90837, 'CPT4', 'IN04', 11, 'S', 'CP', 142.78),
  STRUCT(8177025, 63376, 92014, 'CPT4', 'MO03', 11, 'S', '30401', 108.06),
  STRUCT(8165667, 48323, 99213, 'CPT4', 'MI01', 11, 'S', '10401', 91.58),
  STRUCT(8154700, 11201, 97810, 'CPT4', 'GN01', 11, 'S', 'AP', 31.49),
  STRUCT(8149250, 20852, 97110, 'CPT4', 'MD02', 11, 'S', 'DC', 22.98),
  STRUCT(8098788, 10543, 97811, 'CPT4', 'GN01', 11, 'S', '10401', 23.38),
  STRUCT(8086959, 10032, 97811, 'CPT4', 'GN01', 11, 'S', 'AP', 23.38),
  STRUCT(7974147, 11570, 45380, 'CPT4', 'GN01', 24, 'S', '10307', 240.32),
  STRUCT(7967763, 29464, 98943, 'CPT4', 'SC01', 11, 'S', 'DC', 17.66),
  STRUCT(7930453, 11733, 97810, 'CPT4', 'GN01', 11, 'S', 'AP', 31.49),
  STRUCT(7928640, 33326, 97810, 'CPT4', 'FL04', 11, 'S', 'AP', 29.14),
  STRUCT(7883146, 11010, 98940, 'CPT4', 'GN01', 11, 'S', 'DC', 16.53),
  STRUCT(7869554, 98026, 92015, 'CPT4', 'WA01', 11, 'S', 'OP', 25.78),
  STRUCT(7800408, 30329, 97811, 'CPT4', 'GA01', 11, 'S', 'AP', 25.26),
  STRUCT(7775150, 11426, 97110, 'CPT4', 'GN01', 11, 'S', '10801', 19.41),
  STRUCT(7771845, 46582, 92015, 'CPT4', 'IN05', 11, 'S', 'OP', 16.23),
  STRUCT(7768274, 22044, 98943, 'CPT4', NULL, 11, 'S', 'DC', 18.38),
  STRUCT(7703066, 10577, 45380, 'CPT4', 'GN01', 24, 'S', '10201', 240.32),
  STRUCT(7651557, 21224, 98940, 'CPT4', 'MD01', 11, 'S', 'DC', 18.46),
  STRUCT(7625658, 24060, 17000, 'CPT4', 'VA04', 11, 'S', '10601', 72.4),
  STRUCT(7611482, 64068, 92014, 'CPT4', 'MO02', 11, 'S', '30401', 96.15),
  STRUCT(7576888, 90069, 76830, 'CPT4', 'CA02', 11, 'S', '20101', 126.18),
  STRUCT(7568384, 18901, 17000, 'CPT4', 'PA01', 11, 'S', '10601', 61.8),
  STRUCT(7554949, 98409, 92015, 'CPT4', 'WA01', 11, 'S', 'OP', 25.78),
  STRUCT(7480339, 33611, 99386, 'CPT4', 'FL03', 11, 'S', '10301', 104.35),
  STRUCT(7449845, 87109, 45380, 'CPT4', 'NM01', 24, 'S', '10301', 289.58),
  STRUCT(7432391, 34652, 98941, 'CPT4', 'FL03', 11, 'S', 'DC', 21.59),
  STRUCT(7423524, 84010, 97112, 'CPT4', 'UT01', 11, 'S', 'PT', 32.94),
  STRUCT(7393307, 11706, 97124, 'CPT4', 'GN01', 11, 'S', 'DC', 15.74),
  STRUCT(7362313, 62704, 98943, 'CPT4', 'IL05', 11, 'S', 'DC', 19.68),
  STRUCT(7356782, 20010, 98943, 'CPT4', 'DC01', 11, 'S', 'DC', 18.38),
  STRUCT(7337981, 20850, 98943, 'CPT4', 'MD02', 11, 'S', 'DC', 18.38),
  STRUCT(7284812, 84660, 97112, 'CPT4', 'UT01', 11, 'S', 'PT', 32.94),
  STRUCT(7236648, 53226, 80053, 'CPT4', 'WI01', 81, 'S', 'LB', 12.67),
  STRUCT(7221198, 10007, 98943, 'CPT4', 'GN01', 11, 'S', 'DC', 15.99),
  STRUCT(7176474, 10016, 97112, 'CPT4', 'GN01', 11, 'S', 'PT', 20.29),
  STRUCT(7160964, 84095, 97112, 'CPT4', 'UT01', 11, 'S', 'PT', 32.94),
  STRUCT(7129361, 60091, 90837, 'CPT4', 'IL02', 11, 'S', 'SW', 116.05),
  STRUCT(7105555, 28078, 90837, 'CPT4', 'NC01', 11, 'S', 'SW', 138.61),
  STRUCT(7100333, 89523, 98941, 'CPT4', 'NV02', 11, 'S', 'DC', 30.29),
  STRUCT(7096481, 20007, 97112, 'CPT4', 'DC01', 11, 'S', 'PT', 26.44),
  STRUCT(7048575, 97013, 98941, 'CPT4', 'OR01', 11, 'S', 'DC', 31.2),
  STRUCT(6938617, 90069, 97810, 'CPT4', 'CA02', 11, 'S', 'AP', 34.07),
  STRUCT(6919343, 66048, 45378, 'CPT4', 'KS01', 24, 'S', '10307', 190.8),
  STRUCT(6836246, 78757, 98943, 'CPT4', 'TX04', 11, 'S', 'DC', 15.08),
  STRUCT(6824346, 36532, 97110, 'CPT4', 'AL03', 11, 'S', 'DC', 27.93),
  STRUCT(6787243, 22101, 97811, 'CPT4', 'VA01', 11, 'S', 'AP', 27.49),
  STRUCT(6721800, 11201, 97124, 'CPT4', 'GN01', 11, 'S', 'AP', 15.74),
  STRUCT(6622723, 98029, 97112, 'CPT4', 'WA01', 11, 'S', 'PT', 33.18),
  STRUCT(6571059, 20121, 97810, 'CPT4', 'VA01', 11, 'S', 'AP', 36.72),
  STRUCT(6545686, 23111, 17000, 'CPT4', 'VA02', 11, 'S', '10601', 72.4),
  STRUCT(6477678, 63127, 17000, 'CPT4', 'MO03', 11, 'S', '10601', 49.11),
  STRUCT(6443139, 84790, 90837, 'CPT4', 'UT01', 11, 'S', 'SW', 92.39),
  STRUCT(6422702, 22030, 97810, 'CPT4', 'VA01', 11, 'S', 'AP', 36.72),
  STRUCT(6397988, 10536, 98940, 'CPT4', 'GN01', 11, 'S', 'DC', 16.53),
  STRUCT(6362513, 10577, 92015, 'CPT4', 'GN01', 11, 'S', '30401', 16.92),
  STRUCT(6342705, 18810, 98943, 'CPT4', 'PA09', 11, 'S', 'DC', 16.01),
  STRUCT(6322269, 11779, 97810, 'CPT4', 'GN01', 11, 'S', 'AP', 31.49),
  STRUCT(6316315, 23456, 98940, 'CPT4', 'VA03', 11, 'S', 'DC', 17.16),
  STRUCT(6314401, 99352, 45378, 'CPT4', 'WA03', 24, 'S', '30201', 251.28),
  STRUCT(6285017, 89511, 76830, 'CPT4', 'NV02', 11, 'S', '20101', 134.45),
  STRUCT(6192937, 75093, 97110, 'CPT4', 'TX01', 11, 'S', 'DC', 14.04),
  STRUCT(6177484, 19006, 17000, 'CPT4', 'PA01', 11, 'S', '10601', 61.8),
  STRUCT(6151221, 12524, 97124, 'CPT4', 'GN01', 11, 'S', 'AP', 15.74),
  STRUCT(6079987, 20814, 97811, 'CPT4', 'MD02', 11, 'S', 'AP', 27.49),
  STRUCT(6077053, 67037, 90837, 'CPT4', 'KS02', 11, 'S', 'MT', 105.97),
  STRUCT(6055037, 12205, 97110, 'CPT4', 'NY02', 11, 'S', 'DC', 15.37),
  STRUCT(6042079, 11706, 97124, 'CPT4', 'GN01', 11, 'S', 'DC', 15.74),
  STRUCT(6028031, 35758, 55250, 'CPT4', 'AL02', 11, 'S', '31001', 500.96),
  STRUCT(6015239, 99686, 90837, 'CPT4', 'AK01', 11, 'S', 'SW', 169.37),
  STRUCT(5976366, 33511, 97810, 'CPT4', 'FL03', 11, 'S', 'AP', 29.57),
  STRUCT(5876859, 99508, 97112, 'CPT4', 'AK01', 11, 'S', 'PT', 66.39),
  STRUCT(5854490, 11361, 97110, 'CPT4', 'GN01', 11, 'S', 'DC', 19.41),
  STRUCT(5811094, 78163, 17000, 'CPT4', 'TX02', 11, 'S', '10601', 60.55),
  STRUCT(5791165, 27265, 92015, 'CPT4', 'NC04', 11, 'S', 'OP', 19.42),
  STRUCT(5780904, 37128, 98941, 'CPT4', 'TN01', 11, 'S', 'DC', 23.96),
  STRUCT(5716693, 21210, 97810, 'CPT4', 'MD01', 11, 'S', 'AP', 35.27),
  STRUCT(5679796, 21401, 97810, 'CPT4', 'MD01', 11, 'S', 'AP', 35.27),
  STRUCT(5661866, 91748, 97810, 'CPT4', 'CA02', 11, 'S', 'AP', 34.07),
  STRUCT(5658764, 27834, 55250, 'CPT4', 'NC06', 11, 'S', '31001', 328.35),
  STRUCT(5653631, 10022, 99386, 'CPT4', 'GN01', 11, 'S', '20101', 114.17),
  STRUCT(5535899, 19087, 17000, 'CPT4', 'PA01', 11, 'S', '10601', 61.8),
  STRUCT(5499953, 20904, 90837, 'CPT4', 'MD02', 11, 'S', 'LPC', 101.35),
  STRUCT(5486896, 28173, 98940, 'CPT4', 'NC01', 11, 'S', 'DC', 18.98),
  STRUCT(5445387, 21084, 97112, 'CPT4', 'MD01', 11, 'S', 'PT', 24.99),
  STRUCT(5418467, 20190, 58300, 'CPT4', 'VA01', 11, 'S', '20101', 95.8),
  STRUCT(5373924, 89052, 99385, 'CPT4', 'NV01', 11, 'S', '20101', 102.82),
  STRUCT(5350484, 22801, 98940, 'CPT4', 'VA04', 11, 'S', 'DC', 17.16),
  STRUCT(5321978, 27932, 98943, 'CPT4', 'NC06', 11, 'S', 'DC', 18.23),
  STRUCT(5313509, 33812, 97110, 'CPT4', 'FL03', 11, 'S', 'DC', 16.56),
  STRUCT(5214825, 27573, 98941, 'CPT4', 'NC02', 11, 'S', 'DC', 27.29),
  STRUCT(5197637, 22003, 97811, 'CPT4', 'VA01', 11, 'S', 'AP', 27.49),
  STRUCT(5130246, 28328, 98941, 'CPT4', 'NC02', 11, 'S', 'DC', 27.29),
  STRUCT(5129886, 22044, 98940, 'CPT4', 'VA01', 11, 'S', 'DC', 19.39),
  STRUCT(5114460, 10032, 97811, 'CPT4', 'GN01', 11, 'S', 'AP', 23.38),
  STRUCT(5089268, 10601, 99385, 'CPT4', 'GN01', 11, 'S', '10301', 98.28),
  STRUCT(4989043, 22151, 98943, 'CPT4', 'VA01', 11, 'S', 'DC', 18.38),
  STRUCT(4937018, 15090, 98943, 'CPT4', 'PA03', 11, 'S', 'DC', 16.01),
  STRUCT(4887045, 10011, 97810, 'CPT4', 'GN01', 11, 'S', 'AP', 31.49),
  STRUCT(4821299, 90815, 97810, 'CPT4', 'CA02', 11, 'S', 'AP', 34.07),
  STRUCT(4769221, 20151, 97810, 'CPT4', 'VA01', 11, 'S', 'AP', 36.72),
  STRUCT(4618957, 11223, 45380, 'CPT4', 'GN01', 24, 'S', '10301', 240.32),
  STRUCT(4607765, 63090, 99213, 'CPT4', 'MO03', 11, 'S', '10401', 63.23),
  STRUCT(4539554, 95376, 98943, 'CPT4', 'CA05', 11, 'S', 'DC', 22.0),
  STRUCT(4489893, 33624, 98943, 'CPT4', 'FL03', 11, 'S', 'DC', 15.0),
  STRUCT(4476171, 78664, 98943, 'CPT4', 'TX04', 11, 'S', 'DC', 15.08),
  STRUCT(4459236, 19106, 17000, 'CPT4', 'PA01', 11, 'S', '10601', 61.8),
  STRUCT(4410858, 33467, 90837, 'CPT4', 'FL04', 11, 'S', 'SW', 79.29),
  STRUCT(4367071, 90025, 97810, 'CPT4', 'CA02', 11, 'S', 'AP', 34.07),
  STRUCT(4322881, 29512, 97110, 'CPT4', 'SC05', 11, 'S', 'DC', 20.75),
  STRUCT(4305506, 11426, 97124, 'CPT4', 'GN01', 11, 'S', '10801', 15.74),
  STRUCT(4212744, 99508, 97811, 'CPT4', 'AK01', 11, 'S', 'AP', 64.11),
  STRUCT(4203232, 10003, 97811, 'CPT4', 'GN01', 11, 'S', 'AP', 23.38),
  STRUCT(4186803, 60301, 90837, 'CPT4', 'IL02', 11, 'S', 'BHG', 154.74),
  STRUCT(4124527, 22003, 97810, 'CPT4', 'VA01', 11, 'S', 'AP', 36.72),
  STRUCT(4112841, 60510, 90837, 'CPT4', 'IL02', 11, 'S', 'BHG', 154.74),
  STRUCT(4088891, 22182, 99386, 'CPT4', 'VA01', 11, 'S', '10301', 147.9),
  STRUCT(4002138, 22314, 97112, 'CPT4', 'VA01', 11, 'S', 'PT', 26.44),
  STRUCT(3973102, 20147, 99213, 'CPT4', 'VA01', 11, 'S', '10601', 73.38),
  STRUCT(3949293, 70737, 98943, 'CPT4', 'LA03', 11, 'S', 'DC', 26.08),
  STRUCT(3833519, 22046, 98940, 'CPT4', 'VA01', 11, 'S', 'DC', 19.39),
  STRUCT(3829230, 18940, 90837, 'CPT4', 'PA01', 11, 'S', 'LPC', 110.21),
  STRUCT(3767953, 33178, 97810, 'CPT4', 'FL04', 11, 'S', 'AP', 29.14),
  STRUCT(3747794, 14217, 98943, 'CPT4', 'NY04', 11, 'S', 'DC', 19.14),
  STRUCT(3744431, 28207, 98940, 'CPT4', 'NC01', 11, 'S', 'DC', 18.98),
  STRUCT(3742357, 83687, 45380, 'CPT4', 'ID01', 24, 'S', '10307', 587.35),
  STRUCT(3700927, 33178, 97810, 'CPT4', 'FL04', 11, 'S', 'AP', 29.14),
  STRUCT(3684133, 12524, 97124, 'CPT4', 'GN01', 11, 'S', 'AP', 15.74),
  STRUCT(3645962, 20005, 97112, 'CPT4', 'DC01', 11, 'S', 'PT', 26.44),
  STRUCT(3624408, 10305, 98940, 'CPT4', 'GN01', 11, 'S', 'DC', 16.53),
  STRUCT(3624317, 29841, 98941, 'CPT4', 'SC02', 11, 'S', 'DC', 26.93),
  STRUCT(3517222, 23321, 98940, 'CPT4', 'VA03', 11, 'S', 'DC', 17.16),
  STRUCT(3514459, 19104, 99386, 'CPT4', 'PA01', 11, 'S', '20101', 129.83),
  STRUCT(3513707, 16501, 92015, 'CPT4', 'PA07', 11, 'S', '10414', 19.19),
  STRUCT(3503139, 84043, 90837, 'CPT4', 'UT01', 11, 'S', 'LPC', 92.39),
  STRUCT(3496685, 89128, 99385, 'CPT4', 'NV01', 11, 'S', '10201', 102.82),
  STRUCT(3459247, 89106, 90837, 'CPT4', 'NV01', 11, 'S', 'SW', 110.02),
  STRUCT(3437394, 22180, 98941, 'CPT4', 'VA01', 11, 'S', 'DC', 27.74),
  STRUCT(3294851, 90703, 97810, 'CPT4', 'CA02', 11, 'S', 'AP', 34.07),
  STRUCT(3281595, 63118, 98940, 'CPT4', 'MO03', 11, 'S', 'DC', 21.29),
  STRUCT(3248208, 10541, 97112, 'CPT4', 'GN01', 11, 'S', 'PT', 20.29),
  STRUCT(3164175, 33611, 99385, 'CPT4', 'FL03', 11, 'S', '10301', 89.35),
  STRUCT(3157420, 11530, 45380, 'CPT4', 'GN01', 24, 'S', '10307', 240.32),
  STRUCT(3140703, 21234, 98940, 'CPT4', 'MD01', 11, 'S', 'DC', 18.46),
  STRUCT(3102509, 34453, 98941, 'CPT4', 'FL03', 11, 'S', 'DC', 21.59),
  STRUCT(3102437, 35243, 76830, 'CPT4', 'AL04', 11, 'S', '20101', 153.45),
  STRUCT(3096785, 28277, 98943, 'CPT4', 'NC01', 11, 'S', 'DC', 18.23),
  STRUCT(3078865, 11201, 97124, 'CPT4', 'GN01', 11, 'S', 'AP', 15.74),
  STRUCT(2991099, 70506, 98940, 'CPT4', 'LA04', 11, 'S', 'DC', 25.04),
  STRUCT(2840099, 22003, 97810, 'CPT4', 'VA01', 11, 'S', 'AP', 36.72),
  STRUCT(2808185, 35758, 99386, 'CPT4', 'AL02', 11, 'S', '20101', 131.13),
  STRUCT(2801415, 99503, 97810, 'CPT4', 'AK01', 11, 'S', 'ND', 83.92),
  STRUCT(2773168, 21042, 97810, 'CPT4', 'MD02', 11, 'S', 'AP', 36.72),
  STRUCT(2671141, 33334, 92014, 'CPT4', 'FL04', 11, 'S', '30401', 90.99),
  STRUCT(2605072, 50111, 98941, 'CPT4', 'IA01', 11, 'S', 'DC', 25.34),
  STRUCT(2569136, 22101, 97811, 'CPT4', 'VA01', 11, 'S', 'AP', 27.49),
  STRUCT(2462912, 84010, 97112, 'CPT4', 'UT01', 11, 'S', 'PT', 32.94),
  STRUCT(2425705, 99352, 90837, 'CPT4', 'WA03', 11, 'S', '91006', 142.69),
  STRUCT(2407038, 23229, 98941, 'CPT4', 'VA02', 11, 'S', 'DC', 24.91),
  STRUCT(2399845, 27511, 90837, 'CPT4', 'NC02', 11, 'S', 'BHG', 184.81),
  STRUCT(2392784, 10017, 97810, 'CPT4', 'GN01', 11, 'S', 'AP', 31.49),
  STRUCT(2344318, 61350, 90837, 'CPT4', 'IL05', 11, 'S', 'SW', 108.75),
  STRUCT(2269835, 28083, 98943, 'CPT4', 'NC01', 11, 'S', 'DC', 18.23),
  STRUCT(2263368, 27889, 98940, 'CPT4', 'NC06', 11, 'S', 'DC', 18.98),
  STRUCT(2209101, 77584, 55250, 'CPT4', 'TX03', 11, 'S', '31001', 394.14),
  STRUCT(2191678, 70119, 98940, 'CPT4', 'LA01', 11, 'S', 'DC', 23.56),
  STRUCT(2166000, 10019, 76830, 'CPT4', 'GN01', 11, 'S', '20105', 95.31),
  STRUCT(2124007, 11354, 97110, 'CPT4', 'GN01', 11, 'S', 'DC', 19.41),
  STRUCT(2114404, 84041, 90837, 'CPT4', 'UT01', 11, 'S', 'SW', 92.39),
  STRUCT(2109999, 22408, 99213, 'CPT4', 'VA01', 11, 'S', '10313', 73.38),
  STRUCT(2080377, 10021, 97811, 'CPT4', 'GN01', 11, 'S', 'AP', 23.38),
  STRUCT(2078668, 98201, 90837, 'CPT4', 'WA01', 11, 'S', 'CP', 142.69),
  STRUCT(2074503, 27028, 98941, 'CPT4', 'NC04', 11, 'S', 'DC', 27.29),
  STRUCT(2070754, 18337, 97110, 'CPT4', 'PA09', 11, 'S', 'DC', 20.14),
  STRUCT(2035410, 23229, 99385, 'CPT4', 'VA02', 11, 'S', '10401', 117.57),
  STRUCT(2027570, 12065, 97810, 'CPT4', 'NY02', 11, 'S', 'AP', 46.4),
  STRUCT(2009840, 11418, 92015, 'CPT4', 'GN01', 11, 'S', '30401', 16.92),
  STRUCT(1948601, 11756, 90837, 'CPT4', 'GN01', 11, 'S', 'BHG', 160.89),
  STRUCT(1884462, 28584, 97110, 'CPT4', 'NC06', 11, 'S', 'PT', 24.64),
  STRUCT(1865266, 27262, 98941, 'CPT4', 'NC04', 11, 'S', 'DC', 27.29),
  STRUCT(1794535, 67212, 90837, 'CPT4', 'KS02', 11, 'S', 'MT', 105.97),
  STRUCT(1791435, 60187, 99385, 'CPT4', 'IL02', 11, 'S', '90351', 118.51),
  STRUCT(1785453, 10301, 98940, 'CPT4', 'GN01', 11, 'S', 'DC', 16.53),
  STRUCT(1778218, 13827, 97112, 'CPT4', 'NY03', 11, 'S', 'PT', 16.19),
  STRUCT(1716285, 99503, 98941, 'CPT4', 'AK01', 11, 'S', 'DC', 84.44),
  STRUCT(1697974, 24153, 98940, 'CPT4', 'VA04', 11, 'S', 'DC', 17.16),
  STRUCT(1658020, 46040, 58300, 'CPT4', 'IN04', 11, 'S', '10201', 109.26),
  STRUCT(1613139, 18901, 98940, 'CPT4', 'PA01', 11, 'S', 'DC', 17.95),
  STRUCT(1598128, 21015, 97811, 'CPT4', 'MD01', 11, 'S', 'AP', 26.59),
  STRUCT(1593835, 77584, 55250, 'CPT4', 'TX03', 11, 'S', '31001', 394.14),
  STRUCT(1586791, 11701, 97810, 'CPT4', 'GN01', 11, 'S', 'AP', 31.49),
  STRUCT(1580674, 11510, 97112, 'CPT4', 'GN01', 11, 'S', 'PT', 20.29),
  STRUCT(1574127, 22209, 17000, 'CPT4', 'VA01', 11, 'S', '10601', 69.92),
  STRUCT(1534817, 93551, 97112, 'CPT4', 'CA02', 11, 'S', '10801', 22.61),
  STRUCT(1509112, 33756, 99386, 'CPT4', 'FL03', 11, 'S', '10201', 104.35),
  STRUCT(1426336, 10075, 97810, 'CPT4', 'GN01', 11, 'S', 'AP', 31.49),
  STRUCT(1407880, 84770, 98941, 'CPT4', 'UT01', 11, 'S', 'DC', 35.0),
  STRUCT(1395539, 22003, 97810, 'CPT4', 'VA01', 11, 'S', 'AP', 36.72),
  STRUCT(1389612, 27889, 98940, 'CPT4', 'NC06', 11, 'S', 'DC', 18.98),
  STRUCT(1313226, 12866, 98940, 'CPT4', 'NY02', 11, 'S', 'DC', 20.01),
  STRUCT(1307811, 10003, 97811, 'CPT4', 'GN01', 11, 'S', 'AP', 23.38),
  STRUCT(1304129, 33414, 99386, 'CPT4', 'FL04', 11, 'S', '10201', 119.35),
  STRUCT(1286234, 34109, 98941, 'CPT4', 'FL03', 11, 'S', 'DC', 21.59),
  STRUCT(1284082, 20024, 97810, 'CPT4', 'DC01', 11, 'S', 'AP', 36.72),
  STRUCT(1261328, 10016, 97810, 'CPT4', 'GN01', 11, 'S', 'AP', 31.49),
  STRUCT(1226959, 15228, 17000, 'CPT4', 'PA03', 11, 'S', '10601', 57.93),
  STRUCT(1217805, 89502, 97810, 'CPT4', 'NV02', 11, 'S', 'AP', 43.99),
  STRUCT(1162410, 10001, 97811, 'CPT4', 'GN01', 11, 'S', 'AP', 23.38),
  STRUCT(1153886, 20814, 97811, 'CPT4', 'MD02', 11, 'S', 'AP', 27.49),
  STRUCT(1124956, 22003, 97810, 'CPT4', 'VA01', 11, 'S', 'AP', 36.72),
  STRUCT(1093346, 10003, 97811, 'CPT4', 'GN01', 11, 'S', 'AP', 23.38),
  STRUCT(1039361, 98052, 97810, 'CPT4', 'WA01', 11, 'S', 'AP', 42.75),
  STRUCT(1028620, 11780, 97810, 'CPT4', 'GN01', 11, 'S', 'AP', 31.49),
  STRUCT(1023554, 20121, 99386, 'CPT4', 'VA01', 11, 'S', '10301', 147.9),
  STRUCT(953756, 60540, 58300, 'CPT4', 'IL02', 11, 'S', '20101', 105.45),
  STRUCT(926275, 20850, 97811, 'CPT4', 'MD02', 11, 'S', 'AP', 27.49),
  STRUCT(881119, 20152, 99213, 'CPT4', 'VA01', 11, 'S', '20101', 73.38),
  STRUCT(863888, 27615, 98941, 'CPT4', 'NC02', 11, 'S', 'DC', 27.29),
  STRUCT(850396, 10583, 92014, 'CPT4', 'GN01', 11, 'S', '10414', 94.41),
  STRUCT(702465, 27889, 98943, 'CPT4', 'NC06', 11, 'S', 'DC', 18.23),
  STRUCT(698009, 22101, 97810, 'CPT4', 'VA01', 11, 'S', 'AP', 36.72),
  STRUCT(646550, 10038, 97811, 'CPT4', 'GN01', 11, 'S', 'AP', 23.38),
  STRUCT(542039, 17015, 17000, 'CPT4', 'PA04', 11, 'S', '10601', 57.93),
  STRUCT(426836, 20164, 97110, 'CPT4', 'VA01', 11, 'S', 'DC', 22.98),
  STRUCT(425185, 30308, 97110, 'CPT4', 'GA01', 11, 'S', 'DC', 19.67),
  STRUCT(421494, 20036, 97810, 'CPT4', 'DC01', 11, 'S', 'AP', 36.72),
  STRUCT(335017, 98270, 98943, 'CPT4', 'WA01', 11, 'S', 'DC', 25.69),
  STRUCT(326015, 72015, 90837, 'CPT4', 'AR01', 11, 'S', 'LPC', 78.49),
  STRUCT(318382, 20754, 98941, 'CPT4', 'MD01', 11, 'S', 'DC', 26.48),
  STRUCT(278380, 83814, 17000, 'CPT4', 'WA03', 11, 'S', '10601', 88.53),
  STRUCT(271621, 82901, 97110, 'CPT4', 'WY01', 11, 'S', 'PT', 30.0),
  STRUCT(258217, 24014, 45378, 'CPT4', 'VA04', 24, 'S', '10307', 211.85),
  STRUCT(215674, 10021, 97811, 'CPT4', 'GN01', 11, 'S', 'AP', 23.38),
  STRUCT(161629, 11375, 92014, 'CPT4', 'GN01', 11, 'S', '30401', 94.41),
  STRUCT(144601, 11354, 97112, 'CPT4', 'GN01', 11, 'S', 'DC', 20.29),
  STRUCT(127980, 48323, 99213, 'CPT4', 'MI01', 11, 'S', '10401', 91.58),
  STRUCT(62704, 11784, 97811, 'CPT4', 'GN01', 11, 'S', 'AP', 23.38),
  STRUCT(31148, 32541, 58300, 'CPT4', 'FL05', 11, 'S', '20101', 85.22)
  ])
),
JoinedRates AS (
    SELECT
        t.*,
        -- Set rate_found to 1 if a matching record exists in CET_RATES, 0 otherwise
        CASE WHEN r.SERVICE_CD IS NOT NULL THEN 1 ELSE 0 END AS rate_found
    FROM
        test_cases t
    LEFT JOIN
        CET_RATES r
    ON
        r.RATE_SYSTEM_CD = 'REF'
        AND r.SERVICE_CD = t.service_cd
        AND r.SERVICE_TYPE_CD = t.service_type_cd
        AND r.GEOGRAPHIC_AREA_CD = t.geographic_area_cd
        AND r.PLACE_OF_SERVICE_CD = t.place_of_service_cd
        AND r.PRODUCT_CD = 'MC'
        AND r.CONTRACT_TYPE = 'S'
        AND r.SPECIALTY_CD = t.specialty_cd
        AND r.RATE = t.allowed_amt
)
SELECT
    *,
    -- Cumulative count of records where the rate was found
    SUM(CASE WHEN rate_found = 1 THEN 1 ELSE 0 END) OVER (ORDER BY row_num) AS total_rate_found,
    -- Cumulative count of records where the rate was not found
    SUM(CASE WHEN rate_found = 0 THEN 1 ELSE 0 END) OVER (ORDER BY row_num) AS total_rate_not_found
FROM
    JoinedRates
ORDER BY
    row_num;
